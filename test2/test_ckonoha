#!/bin/bash
# generated by kimio

GLOBALSCORE=0
GLOBALMAX=0

OUTFILE=ckonoha

if [ -f "${OUTFILE}.txt" ] ; then
	rm -rf "${OUTFILE}.txt"
fi

if [ -f "${OUTFILE}.csv" ] ; then
	rm -rf "${OUTFILE}.csv"
fi

function run_test { # count max profile options, file
	echo -n "[$1/$2] running test $4 $5 .."
	KONOHA_TESTPROFILE=$3 minikonoha $4 $5 > /dev/null
	result=$?
	#echo $result
	if [ $result -eq 0 ] ; then
		echo "[PASS]"
		PASS=$(($PASS + 1))
	else
		echo "[FAILED]"
		echo "## [FAILED] $4 $5" >> "${OUTFILE}.txt"
		cat $5 >> "${OUTFILE}.txt"
		echo "RESULT:" >> "${OUTFILE}.txt"
		KONOHA_TESTPROFILE=$3 minikonoha $4 $5 >> "${OUTFILE}.txt"
		if [ $result -eq 78 ] ; then
			echo "diff $5.$3_proof $5.$3_tested" >> "${OUTFILE}.txt"
			diff $5.$3_proof $5.$3_tested >> "${OUTFILE}.txt"
		fi
		echo >> "${OUTFILE}.txt"
	fi
}

function record_result { # test, count, max
	GLOBALSCORE=$(($GLOBALSCORE + $2))
	GLOBALMAX=$(($GLOBALMAX + $3))
	per=$(($2 * 100 / $3))
	echo "(TEST $1) [$2/$3, $per%]"
	echo "$1, $2, $3" >> "${OUTFILE}.csv"
}

function total {
	per=$(($GLOBALSCORE * 100 / $GLOBALMAX))
	echo "((TOTAL)) [$GLOBALSCORE/$GLOBALMAX, $per%]"
	echo "MORE INFO: ${OUTFILE}.csv ${OUTFILE}.txt"
}

## 0001_Assertion
PASS=0
run_test 1 8 standard "-MOutputTest" 0001_Assertion/Assertion_False.k
run_test 2 8 standard "-MOutputTest" 0001_Assertion/Assertion_TopLevelFalse.k
run_test 3 8 standard "-MOutputTest" 0001_Assertion/Assertion_TopLevelTrue.k
run_test 4 8 standard "-MOutputTest" 0001_Assertion/Assertion_True.k
run_test 5 8 cstyle "-MOutputTest -Icstyle" 0001_Assertion/Assertion_False.k
run_test 6 8 cstyle "-MOutputTest -Icstyle" 0001_Assertion/Assertion_TopLevelFalse.k
run_test 7 8 cstyle "-MOutputTest -Icstyle" 0001_Assertion/Assertion_TopLevelTrue.k
run_test 8 8 cstyle "-MOutputTest -Icstyle" 0001_Assertion/Assertion_True.k
record_result 0001_Assertion $PASS 8
## 0002_SystemPrint
PASS=0
run_test 1 12 standard "-MOutputTest" 0002_SystemPrint/SystemPrint_HelloWorld.k
run_test 2 12 standard "-MOutputTest" 0002_SystemPrint/SystemPrint_Integer.k
run_test 3 12 standard "-MOutputTest" 0002_SystemPrint/SystemPrint_Number.k
run_test 4 12 standard "-MOutputTest" 0002_SystemPrint/SystemPrint_TopLevel.k
run_test 5 12 standard "-MOutputTest" 0002_SystemPrint/SystemPrint_Variable.k
run_test 6 12 standard "-MOutputTest" 0002_SystemPrint/SystemPrint_VariableInt.k
run_test 7 12 cstyle "-MOutputTest -Icstyle" 0002_SystemPrint/SystemPrint_HelloWorld.k
run_test 8 12 cstyle "-MOutputTest -Icstyle" 0002_SystemPrint/SystemPrint_Integer.k
run_test 9 12 cstyle "-MOutputTest -Icstyle" 0002_SystemPrint/SystemPrint_Number.k
run_test 10 12 cstyle "-MOutputTest -Icstyle" 0002_SystemPrint/SystemPrint_TopLevel.k
run_test 11 12 cstyle "-MOutputTest -Icstyle" 0002_SystemPrint/SystemPrint_Variable.k
run_test 12 12 cstyle "-MOutputTest -Icstyle" 0002_SystemPrint/SystemPrint_VariableInt.k
record_result 0002_SystemPrint $PASS 12
total

