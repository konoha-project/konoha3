include(CheckFunctionExists)

find_library(HAVE_LIBICONV NAMES iconv)
check_include_files(iconv.h HAVE_ICONV_H)
if(HAVE_LIBICONV AND HAVE_ICONV_H)
	set(HAVE_ICONV 1)
else(HAVE_LIBICONV AND HAVE_ICONV_H)
	if(HAVE_ICONV_H)
		check_function_exists(iconv_open  HAVE_ICONV_OPEN_FUNC)
		check_function_exists(iconv_close HAVE_ICONV_CLOSE_FUNC)
		check_function_exists(iconv       HAVE_ICONV_FUNC)
		if(HAVE_ICONV_OPEN_FUNC AND HAVE_ICONV_CLOSE_FUNC AND HAVE_ICONV_FUNC)
			# glibc iconv
			set(HAVE_ICONV 1)
		endif(HAVE_ICONV_OPEN_FUNC AND HAVE_ICONV_CLOSE_FUNC AND HAVE_ICONV_FUNC)
	endif(HAVE_ICONV_H)
endif(HAVE_LIBICONV AND HAVE_ICONV_H)

if(HAVE_ICONV)
	if(HAVE_LIBICONV)
		set(MODULE_EXTRA_LIBRARY ${HAVE_LIBICONV})
	endif(HAVE_LIBICONV)
	set(MODULE_SOURCE_CODE IConv.c)
	add_konoha_module(IConv)
endif(HAVE_ICONV)
